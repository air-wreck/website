<!DOCTYPE html>
<html lang="en">
<head>
  <title>Eric Zheng | Safe Miner</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/main.css" type="text/css">
  <link rel="stylesheet" href="css/miner.css" type="text/css">
  <link rel="shortcut icon" href="img/ez-01.png" type="image/png">

  <!-- let's not source *two* cryptojacking scripts locally... -->
  <script src="https://authedmine.com/lib/authedmine.min.js?v8"></script>
</head>
<body>
<style>
  body {
    background-color: #666666;
  }
  .ui-box {
    /* uh...red means safe, right? */
    background-color: #ff8e77;
    border: 1px solid #ba2101;
  }
  #control button {
    background-color: #666666;
    border: 2px solid #666666;
  }
  #control .value {
    background-color: #d1d1d1;
  }
</style>

<script>
  // instantiate actual miner
  var miner = new CoinHive.Anonymous("EjEiDKXYS8NINkDFEK9EtEfrDD3yr6BV",
    {throttle: 0.3});

  function toggle_miner() {
    var running = miner.isRunning();

    // toggle miner running status
    if (running)
      miner.stop()
    else miner.start(CoinHive.IF_EXCLUSIVE_TAB);
    running = miner.isRunning();

    // update status label
    var status = document.getElementById("status");
    var button = document.getElementById("switch");
    if (running) {
      status.style.color = "#066600";
      status.textContent = "Active";
      button.style.backgroundColor = "#ffffff";
      button.style.color = "#666666";
      button.textContent = "Switch Off";
    } else {
      status.style.color = "#660800";
      status.textContent = "Inactive";
      button.style.backgroundColor = "#666666";
      button.style.color = "#ffffff";
      button.textContent = "Switch On";
    }
  }


  window.addEventListener("load", _ => {
    // loop through all info boxes and add link effect
    Array.from(document.getElementsByClassName("info-box"))
      .forEach(box => {
        var link = Array.from(box.childNodes)
          .filter(node => node.className === "info-link")[0];
        var info = Array.from(box.childNodes)
          .filter(node => node.className === "info-text")[0];
        info.style.display = "none";

        // toggle info when user clicks on link
        link.addEventListener("click", _ => {
          // toggle ending +/- in text
          function toggle_sign (text) {
            if (text.slice(-1) === "+")
              return text.slice(0,-1) + "-";
            return text.slice(0,-1) + "+";
          }
          link.textContent = toggle_sign(link.textContent);

          // toggle display on info text
          if (info.style.display === "none")
            info.style.display = "inline";
          else info.style.display = "none";
        });
      });


    // add a colon after each control panel field name
    Array.from(document.getElementsByClassName("field"))
      .forEach(el => {
        el.textContent += ":";
      });


    // continually update status fields
    var total = document.getElementById("total");
    var rate = document.getElementById("rate");
    var threads = document.getElementById("threads");
    var throttle = document.getElementById("throttle");
    setInterval(() => {
      total.textContent = miner.getTotalHashes(true).toFixed(0);
      rate.textContent = miner.getHashesPerSecond().toFixed(4);
      threads.textContent = miner.getNumThreads().toFixed(0);
      throttle.textContent = ((1-miner.getThrottle())*100).toFixed(0) + "%";
    }, 500);
  });


  // increment threads and throttle by given amount
  function inc_threads(amt) {
    var new_threads = miner.getNumThreads() + amt;
    if (new_threads >= 1 && new_threads <= navigator.hardwareConcurrency)
      miner.setNumThreads(new_threads);
  }
  var curr_throttle = 70;
  function inc_throttle(amt) {
    var new_throttle = curr_throttle + amt;
    if (new_throttle >= 0 && new_throttle <= 100) {
      curr_throttle = new_throttle;
      miner.setThrottle((100 - curr_throttle) / 100);
    }
  }
</script>

<div class="ui-box">
  <h1>(Safer) Coinhive Miner</h1>
  This page is a slightly less sketchy Monero cryptocurrency miner. After all, red = safe, right? All proceeds go to me. (<a href="miner.html" style="color: black;">back to regular miner</a>)
</div>

<div id="control" class="ui-box">
  <h3>Miner Control Panel</h3> |
  <span class="field">Miner Status</span>
  <span id="status" class="value">Inactive</span>
  <br>
  <button id="switch" onclick="toggle_miner();">Switch On</button>
  <br>
  <span class="field">Total Hashes</span>
  <span id="total" class="value"></span>
  <br>
  <span class="field">Hashes/sec</span>
  <span id="rate" class="value"></span>
  <br>
  <span class="field">Thread Count</span>
  <span id="threads" class="value"></span>
  <button class="increment" onclick="inc_threads(+1);">+</button>
  <button class="increment" onclick="inc_threads(-1);">-</button>
  <br>
  <span class="field">Speed (Throttle)</span>
  <span id="throttle" class="value"></span>
  <button class="increment" onclick="inc_throttle(+10);">+</button>
  <button class="increment" onclick="inc_throttle(-10);">-</button>
</div>

</body>
</html>
